=== Port Scanning 
Metasploit has number of module to scan open ports on the target system and network
Search for modules "portscan"


=== UDP Scanning
scanner/discovery/udp_sweep --> module will allow you to quickly identify services running over the UDP.


=== SMB Scan
search for "smb_enum" for exploits/payloads in metasploit framework



===== Metasploit Database
Metasploit has a database function to simplify project management and avoid possible confusion when setting up parameter values. 


cmd: db_status # to check whether db is initiated and connected or not
This database feature will allow user to create multiple workspaces to isolate different projects, when first launched, you should be in the default workspace. You can list available workspaces using 'workspace' command

cmd: workspace

add a workspace: workspace -a <workspaceName>
delete workspace: workspace -d <workspaceName>
move to different workspace: workspace <workspaceName>
help command: workspace -h

If you run a Nmap scan using the db_nmap shown below, all results will be saved to the database. 

You can now reach information relevant to hosts and services running on target systems with the hosts and services commands, respectively. 

The services command used with the -S parameter will allow you to search for specific services in the environment.



========== Vulnerability Scanning
Metasploit can quickly identify some critical vulnerabilities that could be considered as 'low hanging fruit'.
Finding vulnerabilities using Metasploit will rely heavily on your ability to scan and fingerprint the target.



=========== Exploitation
You can search exploits using the 'search' command, obtain more information about the exploit using the 'info' command, and launch the exploit using 'exploit'

Most of the exploits will have a preset default payload. However, you can always use the show payloads command to list other commands you can use with that specific exploit.

Note that choosing a working payload could become a trial and error process due to environmental or OS restrictions such as firewall rules, anti-virus, file writing, or the program performing the payload execution isn't available (eg. payload/python/shell_reverse_tcp).


Once a session is opened, you can background it using CTRL+Z or abort it using CTRL+C.


The 'sessions' command will list all active sessions. The sessions command supports a number of options that will help you manage sessions better.

You can interact with any existing session using the 'sessions -i' command followed by the session ID.



=========== MsfVenom
Msfvenom, which replaced Msfpayload and Msfencode, allows you to generate payloads.

You can either generate stand-alone payloads (e.g. a Windows executable for Meterpreter) or get a usable raw format (e.g. python)

list supported output formats cmd: msfvenom --list formats

Encoders - encode the payload using '-e' flag





=================== Meterpreter
Meterpreter is a metasploit payload that supports the penetration process with many valuable components.Meterpreter will run on the target system and act as an agent within a command and control architecture


==> How does it work?
-> It runs on the target system but is not installed on it. It runs in memory and does not write itself to the disk on the target.

-> This feature aims to avoid being detected during the antivirus scans.
-> By default most av softwares will scan new files on the disk, Meterpreter runs in memory (RAM) to avoid having a file that has to be written to the disk on the target system.
-> Meterpreter also aims to avoid being detected by network-based IPS (Intrusion Prevention System) and IDS (Intrusion Detection System) solutions by using encrypted communication with the server where Metasploit runs (typically your attacking machine).

'help' will list all the available commands on meterpreter session



===> Meterpreter commands
Every version of meterpreter will have different command options (but most of them stays same)

Meterpreter has three primary category of tools:
1. Built-in commands
2. Meterpreter tools
3. Meterpreter Scripting


The 'help' command will list available commands under different categories such as
1. Core commands
2. File system commands
3. Networking commands
4. System commands
5. User Interface commands
6. Webcam commands
7. Audio output commands
8. Elevate commands
9. Password database commands
10. Timestamp commands



===> Post Exploitation with Meterpreter

cmd: getuid  ==> display username of target system
cmd: ps ==> display running processes in target system
cmd: migrate <pID> ==> migrate to another process will help meterpreter interact with it
cmd: hashdump ==> list the contents of SAM database (SAM - Security Account Managet) db stores users passwords on windows systems. These passwords are stored in NTLM format


While it is not mathematically possible to "crack" these hashes, you may still discover the cleartext password using online NTLM databases or a rainbow table attack. These hashes can also be used in Pass-the-Hash attacks to authenticate to other systems that these users can access the same network.

cmd: search -f <fileName> ==> useful to locate files in target system
cmd: shell ==> will launch a regular command line shell on the target system


in post exploitation phase meterpreter has functions that can asssit:
1. Gather further information about the target system
2. Looking for interesting files, user credentials, additional network interface etc...
3. Privilege escalation
4. Lateral movement

Once any additional tool is loaded using the load command, you will see new options on the help menu.


